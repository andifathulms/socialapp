{% extends 'personal/home.html' %}
{% block head %}
<style>
  @import url('https://fonts.googleapis.com/css2?family=Martel+Sans&display=swap');
  .container{
    font-family: 'Martel Sans', sans-serif;
  }
  #h2ost-title{
    font-size: 2.5rem;
    font-weight: 950;
    line-height: 1.5;
  }
</style>
{% endblock head %}
{% block post %}
<div class="container border p-3" style="border-radius: 10px; background-color: #fff;">
  <div class="pl-3 pr-3" style="width: 80%; margin: auto; overflow: hidden;">
    <h2 id="h2ost-title">{{post.title}}</h2>
    <div>
      <a href="{% url 'account:view' user_id=post.author.profile.pk %}">
        <img class="mr-3 circle-rounded avator" style="float: left;margin-right: 1rem;" width="50" height="50" src="{{ post.author.profile_image.url }}" />
      </a>
      <span>{{ post.author.username }}</span>
      <p>{{ post.created_on|date:"F d, Y" }} . <span id="read_time"></span> min read</p>
    </div>
    <a href="/editpost/{{post.id}}/">Edit</a>
    <section id="post-body" style="clear: both;"></section>
    <script>
      window.addEventListener("DOMContentLoaded", () => {
        const text = "{{post.body|escapejs}}";
        const words = text.trim().split(/\s+/).length;
        const wpm = 225;
        const time = Math.ceil(words / wpm);
        const readTime = document.getElementById("read_time");
        readTime.innerHTML = time;

        const postBody = document.getElementById("post-body");
        console.log("{{post.body|escapejs}}");
        let body = JSON.parse("{{post.body|escapejs}}");
        let blocks = body.blocks;
        console.log(blocks.length);

        for (let index = 0; index <= blocks.length; index++) {
          console.log(blocks[index], index);

          switch (blocks[index].type) {
            case "Header":
              let head = document.createElement(`h${blocks[index].data.level}`);
              head.textContent = blocks[index].data.text;
              postBody.appendChild(head);
              break;

            case "Image":
              let div = document.createElement("div");
              let image = document.createElement("img");
              let caption = document.createElement("small");
              image.src = `${blocks[index].data.file.url}`;
              image.style = "margin-top:10px; max-width:650px; ";
              
              caption.textContent = blocks[index].data.caption;
              caption.style = "margin-top:5px; margin-bottom:8px; color:grey";
              div.appendChild(image);
              div.appendChild(caption);
              div.style = "width:30%;display:grid;place-items:center";
              postBody.appendChild(div);
              break;

            case "List":
              let list;
              if (blocks[index].data.style == "unordered") {
                list = document.createElement("ul");
              } else {
                list = document.createElement("ol");
              }
              for (const item in blocks[index].data.items) {
                let li = document.createElement("li");
                li.textContent = blocks[index].data.items[item];
                li.style = "list-style-type: circle; font-size:1.3rem; margin-bottom:7px;";
                list.appendChild(li);
              }
              list.style = "list-style-type: circle;";
              postBody.appendChild(list);
              break;

            case "Raw":
              let blockquote = document.createElement("blockquote");
              let code = document.createElement("code");
              let pre = document.createElement("pre");
              pre.textContent = blocks[index].data.html;
              pre.style.background = "#131313";
              pre.style.color = "#dddddd";
              pre.style.padding = "15px";
              code.appendChild(pre);
              postBody.appendChild(code);
              break;

            case "Attaches":
              let parent = document.createElement("div");
              parent.style =
                "margin-top:10px;width:30%; padding:10px; border:1px solid black;border-radius:8px;";
              let a = document.createElement("a");
              let name = document.createElement("h4");
              a.href = `${blocks[index].data.file.url}`;
              a.textContent = `Download ${blocks[index].data.file.extension} (${
                blocks[index].data.file.size / 1000
              } kb)`;
              a.style = "grid-column: 1 / span 2";
              name.textContent = blocks[index].data.file.name;

              parent.appendChild(name);
              parent.appendChild(a);

              postBody.appendChild(parent);
              break;

            case "paragraph":
              const p = document.createElement("p");
              p.innerHTML = blocks[index].data.text;
              p.style = "font-size:1.3rem;";
              postBody.appendChild(p);
              break;

            case "Link":
              let parent2 = document.createElement("div");
              let a2 = document.createElement("a");
              parent2.style =
                " margin-top:10px; width:30%;display:grid; grid-template-columns: 1fr 50px; padding:10px; border:1px solid black;border-radius:8px;";

              if (blocks[index].data.meta.title) {
                let title = document.createElement("p");
                title.textContent = blocks[index].data.meta.title;
                parent2.appendChild(title);
              }
              if (blocks[index].data.meta.image.url !== "") {
                let parent3 = document.createElement("div");
                let img = document.createElement("img");

                img.src = blocks[index].data.meta.image.url;
                parent3.style = " display:grid;place-items:center";

                img.height = 40;
                img.width = 40;
                parent3.appendChild(img);
                parent2.appendChild(parent3);
              }

              if (blocks[index].data.meta.description) {
                let desc = document.createElement("small");
                desc.style = "grid-column: 1 / span 2";
                desc.textContent = blocks[index].data.meta.description;
                parent2.appendChild(desc);
              }
              a2.style = "text-decoration:none;color:black";
              a2.href = blocks[index].data.link;
              a2.appendChild(parent2);
              postBody.appendChild(a2);
              break;

            default:
              break;
          }
        }
      });
    </script>
  </div>
</div>
{% endblock post %}